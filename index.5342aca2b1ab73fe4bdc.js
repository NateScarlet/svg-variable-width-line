!function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=0)}([function(t,e,r){t.exports=r(1)},function(t,e,r){"use strict";r.r(e);var n={};r.r(n),r.d(n,"translatePoint",(function(){return u})),r.d(n,"refineFloat",(function(){return a}));var o={};r.r(o),r.d(o,"length",(function(){return c}));var i={};function u(t,e){var r=t.getScreenCTM();if(!r)throw new Error("Should has screen CTM.");var n=t.createSVGPoint();return n.x=e.x,n.y=e.y,n.matrixTransform(r.inverse())}function a(t){return t+8-8}function c(){for(var t=0,e=1;e<arguments.length;e+=1){var r=e-1<0||arguments.length<=e-1?void 0:arguments[e-1],n=e<0||arguments.length<=e?void 0:arguments[e];t+=Math.sqrt(Math.pow(r.x-n.x,2)+Math.pow(r.y-n.y,2))}return t}function s(t,e){var r=t.w/2;if(!e)return{left:{x:t.x,y:t.y+r},right:{x:t.x,y:t.y-r}};var n=Math.atan((t.y-e.y)/(t.x-e.x)),o=a(Math.sin(n)*r),i=a(Math.cos(n)*r);return{left:{x:t.x-o,y:t.y+i},right:{x:t.x+o,y:t.y-i}}}function l(){for(var t=["M"],e=[],r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];for(var i=0;i<n.length;i+=1){var u=s(n[i],n[i-1]||n[i+1]),a=u.left,l=u.right,f=e.slice(i)[0];f&&c(f,a)>c(f,l)?e.splice(i,0,a,l):e.splice(i,0,l,a)}for(var p=0,h=e;p<h.length;p++){var y=h[p];t.push("".concat(y.x,",").concat(y.y))}return{d:t.join(" ")}}function f(t){return function(t){if(Array.isArray(t)){for(var e=0,r=new Array(t.length);e<t.length;e++)r[e]=t[e];return r}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function p(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function h(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?p(r,!0).forEach((function(e){y(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):p(r).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function y(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function v(){var t,e=[];if(0===arguments.length)return[];e.push(h({},arguments.length<=0?void 0:arguments[0]));for(var r=0;r<arguments.length-1;r++){var n=r<0||arguments.length<=r?void 0:arguments[r],o=r+1<0||arguments.length<=r+1?void 0:arguments[r+1];e.push({x:.75*n.x+.25*o.x,y:.75*n.y+.25*o.y,w:.75*n.w+.25*o.w},{x:.25*n.x+.75*o.x,y:.25*n.y+.75*o.y,w:.25*n.w+.75*o.w})}arguments.length>2&&e.push(h({},(t=arguments.length-1)<0||arguments.length<=t?void 0:arguments[t]));return e}function d(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=t,n=0;n<e;n+=1)r=v.apply(void 0,f(r));return r}function g(t){return function(t){if(Array.isArray(t)){for(var e=0,r=new Array(t.length);e<t.length;e++)r[e]=t[e];return r}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function b(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function w(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function m(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}r.r(i),r.d(i,"util",(function(){return n})),r.d(i,"vector2",(function(){return o})),r.d(i,"computeSidePoints",(function(){return s})),r.d(i,"compute",(function(){return l})),r.d(i,"smoothOnce",(function(){return v})),r.d(i,"smooth",(function(){return d}));var O=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.isDrawing=!1,this.points=[],this.width=20,this.el=e}var e,r,u;return e=t,(r=[{key:"onPointerdown",value:function(t){t.preventDefault(),this.isDrawing=!0,this.points=[];var e=document.createElementNS("http://www.w3.org/2000/svg","path");this.el.appendChild(e),this.target=e}},{key:"onPointermove",value:function(t){var e=this;if(this.isDrawing&&(t.preventDefault(),!(this.lastDrawTime&&Date.now()-this.lastDrawTime<4))){this.lastDrawTime=Date.now();var r=n.translatePoint(this.el,t),i={x:r.x,y:r.y,w:t.pressure*this.width},u=this.points.slice(-1)[0];u&&o.length(u,i)<this.width||(this.points.push(i),"mouse"===t.pointerType&&(this.points=this.points.map((function(t,r,n){return function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?b(r,!0).forEach((function(e){w(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):b(r).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({},t,{w:e.width*(r/n.length)})}))),this.update())}}},{key:"onPointerup",value:function(t){t.preventDefault(),this.isDrawing=!1,delete this.target}},{key:"install",value:function(){this.el.addEventListener("pointerdown",this.onPointerdown.bind(this)),this.el.addEventListener("pointermove",this.onPointermove.bind(this)),this.el.addEventListener("pointerup",this.onPointerup.bind(this))}},{key:"update",value:function(){var t=l.apply(i,g(d(this.points,4))).d;this.mustTarget.setAttribute("d",t)}},{key:"mustTarget",get:function(){if(!this.target)throw new Error("Should has target");return this.target}}])&&m(e.prototype,r),u&&m(e,u),t}();!function(){var t=document.querySelector("svg#canvas");if(!(t instanceof SVGSVGElement))throw Error("Missing canvas element");new O(t).install(),t.addEventListener("pointermove",(function(t){var e=document.querySelector("#pressure");e&&(e.textContent=t.pressure.toString())})),t.addEventListener("pointermove",(function(t){var e=document.querySelector("#pointer-type");e&&(e.textContent=t.pointerType)}))}()}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL3V0aWxzL3RyYW5zbGF0ZVBvaW50LnRzIiwid2VicGFjazovLy8uL3NyYy91dGlscy9yZWZpbmVGbG9hdC50cyIsIndlYnBhY2s6Ly8vLi9zcmMvdmVjdG9yMi9sZW5ndGgudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2NvbXB1dGUudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL3Ntb290aC50cyIsIndlYnBhY2s6Ly8vLi9kZW1vL2luZGV4LnRzIl0sIm5hbWVzIjpbImluc3RhbGxlZE1vZHVsZXMiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJleHBvcnRzIiwibW9kdWxlIiwiaSIsImwiLCJtb2R1bGVzIiwiY2FsbCIsIm0iLCJjIiwiZCIsIm5hbWUiLCJnZXR0ZXIiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiciIsIlN5bWJvbCIsInRvU3RyaW5nVGFnIiwidmFsdWUiLCJ0IiwibW9kZSIsIl9fZXNNb2R1bGUiLCJucyIsImNyZWF0ZSIsImtleSIsImJpbmQiLCJuIiwib2JqZWN0IiwicHJvcGVydHkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsInAiLCJzIiwidHJhbnNsYXRlUG9pbnQiLCJlbCIsInBvaW50IiwibWF0cml4IiwiZ2V0U2NyZWVuQ1RNIiwiRXJyb3IiLCJjcmVhdGVTVkdQb2ludCIsIngiLCJ5IiwibWF0cml4VHJhbnNmb3JtIiwiaW52ZXJzZSIsInJlZmluZUZsb2F0IiwidiIsInJldCIsImxlbmd0aCIsInBhIiwicGIiLCJNYXRoIiwic3FydCIsInBvdyIsImNvbXB1dGVTaWRlUG9pbnRzIiwiY3VycmVudCIsInByZXYiLCJ3IiwibGVmdCIsInJpZ2h0IiwiYW5nbGUiLCJhdGFuIiwiZHgiLCJzaW4iLCJkeSIsImNvcyIsImNvbXB1dGUiLCJvcGVyYXRpb25zIiwiZWRnZVBvaW50cyIsInBvaW50cyIsImxhc3RMZWZ0Iiwic2xpY2UiLCJzcGxpY2UiLCJwdXNoIiwiam9pbiIsInNtb290aE9uY2UiLCJwMCIsInAxIiwic21vb3RoIiwidGltZXMiLCJjb3VudCIsImlzRHJhd2luZyIsIndpZHRoIiwidGhpcyIsImUiLCJwcmV2ZW50RGVmYXVsdCIsInRhcmdldCIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudE5TIiwiYXBwZW5kQ2hpbGQiLCJsYXN0RHJhd1RpbWUiLCJEYXRlIiwibm93IiwicHJlc3N1cmUiLCJsYXN0UG9pbnQiLCJwb2ludGVyVHlwZSIsIm1hcCIsImFycmF5IiwidXBkYXRlIiwiYWRkRXZlbnRMaXN0ZW5lciIsIm9uUG9pbnRlcmRvd24iLCJvblBvaW50ZXJtb3ZlIiwib25Qb2ludGVydXAiLCJtdXN0VGFyZ2V0Iiwic2V0QXR0cmlidXRlIiwicXVlcnlTZWxlY3RvciIsIlNWR1NWR0VsZW1lbnQiLCJpbnN0YWxsIiwidGV4dENvbnRlbnQiLCJ0b1N0cmluZyJdLCJtYXBwaW5ncyI6ImFBQ0UsSUFBSUEsRUFBbUIsR0FHdkIsU0FBU0MsRUFBb0JDLEdBRzVCLEdBQUdGLEVBQWlCRSxHQUNuQixPQUFPRixFQUFpQkUsR0FBVUMsUUFHbkMsSUFBSUMsRUFBU0osRUFBaUJFLEdBQVksQ0FDekNHLEVBQUdILEVBQ0hJLEdBQUcsRUFDSEgsUUFBUyxJQVVWLE9BTkFJLEVBQVFMLEdBQVVNLEtBQUtKLEVBQU9ELFFBQVNDLEVBQVFBLEVBQU9ELFFBQVNGLEdBRy9ERyxFQUFPRSxHQUFJLEVBR0pGLEVBQU9ELFFBS2ZGLEVBQW9CUSxFQUFJRixFQUd4Qk4sRUFBb0JTLEVBQUlWLEVBR3hCQyxFQUFvQlUsRUFBSSxTQUFTUixFQUFTUyxFQUFNQyxHQUMzQ1osRUFBb0JhLEVBQUVYLEVBQVNTLElBQ2xDRyxPQUFPQyxlQUFlYixFQUFTUyxFQUFNLENBQUVLLFlBQVksRUFBTUMsSUFBS0wsS0FLaEVaLEVBQW9Ca0IsRUFBSSxTQUFTaEIsR0FDWCxvQkFBWGlCLFFBQTBCQSxPQUFPQyxhQUMxQ04sT0FBT0MsZUFBZWIsRUFBU2lCLE9BQU9DLFlBQWEsQ0FBRUMsTUFBTyxXQUU3RFAsT0FBT0MsZUFBZWIsRUFBUyxhQUFjLENBQUVtQixPQUFPLEtBUXZEckIsRUFBb0JzQixFQUFJLFNBQVNELEVBQU9FLEdBRXZDLEdBRFUsRUFBUEEsSUFBVUYsRUFBUXJCLEVBQW9CcUIsSUFDL0IsRUFBUEUsRUFBVSxPQUFPRixFQUNwQixHQUFXLEVBQVBFLEdBQThCLGlCQUFWRixHQUFzQkEsR0FBU0EsRUFBTUcsV0FBWSxPQUFPSCxFQUNoRixJQUFJSSxFQUFLWCxPQUFPWSxPQUFPLE1BR3ZCLEdBRkExQixFQUFvQmtCLEVBQUVPLEdBQ3RCWCxPQUFPQyxlQUFlVSxFQUFJLFVBQVcsQ0FBRVQsWUFBWSxFQUFNSyxNQUFPQSxJQUN0RCxFQUFQRSxHQUE0QixpQkFBVEYsRUFBbUIsSUFBSSxJQUFJTSxLQUFPTixFQUFPckIsRUFBb0JVLEVBQUVlLEVBQUlFLEVBQUssU0FBU0EsR0FBTyxPQUFPTixFQUFNTSxJQUFRQyxLQUFLLEtBQU1ELElBQzlJLE9BQU9GLEdBSVJ6QixFQUFvQjZCLEVBQUksU0FBUzFCLEdBQ2hDLElBQUlTLEVBQVNULEdBQVVBLEVBQU9xQixXQUM3QixXQUF3QixPQUFPckIsRUFBZ0IsU0FDL0MsV0FBOEIsT0FBT0EsR0FFdEMsT0FEQUgsRUFBb0JVLEVBQUVFLEVBQVEsSUFBS0EsR0FDNUJBLEdBSVJaLEVBQW9CYSxFQUFJLFNBQVNpQixFQUFRQyxHQUFZLE9BQU9qQixPQUFPa0IsVUFBVUMsZUFBZTFCLEtBQUt1QixFQUFRQyxJQUd6Ry9CLEVBQW9Ca0MsRUFBSSxHQUlqQmxDLEVBQW9CQSxFQUFvQm1DLEVBQUksRyxpUENsRi9DLFNBQVVDLEVBQ2RDLEVBQ0FDLEdBRUEsSUFBTUMsRUFBU0YsRUFBR0csZUFFbEIsSUFBS0QsRUFDSCxNQUFNLElBQUlFLE1BQU0sMEJBRWxCLElBQU1QLEVBQUlHLEVBQUdLLGlCQUdiLE9BRkFSLEVBQUVTLEVBQUlMLEVBQU1LLEVBQ1pULEVBQUVVLEVBQUlOLEVBQU1NLEVBQ0xWLEVBQUVXLGdCQUFnQk4sRUFBT08sV0NYNUIsU0FBVUMsRUFBWUMsR0FDMUIsT0FBT0EsRUFBSSxFQUFJLEVDQ1gsU0FBVSxJQUVkLElBREEsSUFBSUMsRUFBTSxFQUNEN0MsRUFBSSxFQUFHQSxFQUFJLFVBQU84QyxPQUFROUMsR0FBSyxFQUFHLENBQ3pDLElBQU0rQyxFQUFZL0MsRUFBSSxFQUFkLHFCQUFVQSxFQUFJLE9BQWQsWUFBVUEsRUFBSSxHQUNoQmdELEVBQVloRCxFQUFWLHFCQUFVQSxPQUFWLFlBQVVBLEdBQ2xCNkMsR0FBT0ksS0FBS0MsS0FBS0QsS0FBS0UsSUFBSUosRUFBR1IsRUFBSVMsRUFBR1QsRUFBRyxHQUFLVSxLQUFLRSxJQUFJSixFQUFHUCxFQUFJUSxFQUFHUixFQUFHLElBRXBFLE9BQU9LLEVDTkgsU0FBVU8sRUFDZEMsRUFDQUMsR0FFQSxJQUFNeEMsRUFBSXVDLEVBQVFFLEVBQUksRUFDdEIsSUFBS0QsRUFDSCxNQUFPLENBQ0xFLEtBQU0sQ0FDSmpCLEVBQUdjLEVBQVFkLEVBQ1hDLEVBQUdhLEVBQVFiLEVBQUkxQixHQUVqQjJDLE1BQU8sQ0FDTGxCLEVBQUdjLEVBQVFkLEVBQ1hDLEVBQUdhLEVBQVFiLEVBQUkxQixJQUlyQixJQUFNNEMsRUFBUVQsS0FBS1UsTUFBTU4sRUFBUWIsRUFBSWMsRUFBS2QsSUFBTWEsRUFBUWQsRUFBSWUsRUFBS2YsSUFDM0RxQixFQUFLakIsRUFBWU0sS0FBS1ksSUFBSUgsR0FBUzVDLEdBQ25DZ0QsRUFBS25CLEVBQVlNLEtBQUtjLElBQUlMLEdBQVM1QyxHQUN6QyxNQUFPLENBQ0wwQyxLQUFNLENBQ0pqQixFQUFHYyxFQUFRZCxFQUFJcUIsRUFDZnBCLEVBQUdhLEVBQVFiLEVBQUlzQixHQUVqQkwsTUFBTyxDQUNMbEIsRUFBR2MsRUFBUWQsRUFBSXFCLEVBQ2ZwQixFQUFHYSxFQUFRYixFQUFJc0IsSUFLZixTQUFVRSxJQUEwQixJQUN4QyxJQUFNQyxFQUF1QixDQUFDLEtBQ3hCQyxFQUF3QixHQUZVLG1CQUFmQyxFQUFlLHlCQUFmQSxFQUFlLGdCQUd4QyxJQUFLLElBQUluRSxFQUFJLEVBQUdBLEVBQUltRSxFQUFPckIsT0FBUTlDLEdBQUssRUFBRyxPQUNqQm9ELEVBQ3RCZSxFQUFPbkUsR0FDUG1FLEVBQU9uRSxFQUFJLElBQU1tRSxFQUFPbkUsRUFBSSxJQUZ0QndELEVBRGlDLEVBQ2pDQSxLQUFNQyxFQUQyQixFQUMzQkEsTUFJUlcsRUFBV0YsRUFBV0csTUFBTXJFLEdBQUcsR0FFbkNvRSxHQUNBLEVBQWVBLEVBQVVaLEdBQVEsRUFBZVksRUFBVVgsR0FFMURTLEVBQVdJLE9BQU90RSxFQUFHLEVBQUd3RCxFQUFNQyxHQUU5QlMsRUFBV0ksT0FBT3RFLEVBQUcsRUFBR3lELEVBQU9ELEdBR25DLGNBQWdCVSxFQUFoQixlQUE0QixDQUF2QixJQUFNcEMsRUFBQyxLQUNWbUMsRUFBV00sS0FBWCxVQUFtQnpDLEVBQUVTLEVBQXJCLFlBQTBCVCxFQUFFVSxJQUc5QixNQUFPLENBQUVsQyxFQURDMkQsRUFBV08sS0FBSyxNLDQvQkNyRHRCLFNBQVVDLElBQ2QsSUFzQnVCLEVBdEJqQjVCLEVBQWUsR0FDckIsR0FBc0IsSUFBbEIsVUFBT0MsT0FDVCxNQUFPLEdBRVRELEVBQUkwQixLQUFKLCtDQUNBLElBQUssSUFBSXZFLEVBQUksRUFBR0EsRUFBSSxVQUFPOEMsT0FBUyxFQUFHOUMsSUFBSyxDQUMxQyxJQUFNMEUsRUFBWTFFLEVBQVYscUJBQVVBLE9BQVYsWUFBVUEsR0FDWjJFLEVBQVkzRSxFQUFJLEVBQWQscUJBQVVBLEVBQUksT0FBZCxZQUFVQSxFQUFJLEdBRXRCNkMsRUFBSTBCLEtBQ0YsQ0FDRWhDLEVBQUcsSUFBT21DLEVBQUduQyxFQUFJLElBQU9vQyxFQUFHcEMsRUFDM0JDLEVBQUcsSUFBT2tDLEVBQUdsQyxFQUFJLElBQU9tQyxFQUFHbkMsRUFDM0JlLEVBQVUsSUFBUG1CLEVBQUduQixFQUFrQixJQUFQb0IsRUFBR3BCLEdBRXRCLENBQ0VoQixFQUFHLElBQU9tQyxFQUFHbkMsRUFBSSxJQUFPb0MsRUFBR3BDLEVBQzNCQyxFQUFHLElBQU9rQyxFQUFHbEMsRUFBSSxJQUFPbUMsRUFBR25DLEVBQzNCZSxFQUFVLElBQVBtQixFQUFHbkIsRUFBa0IsSUFBUG9CLEVBQUdwQixJQUl0QixVQUFPVCxPQUFTLEdBQ2xCRCxFQUFJMEIsS0FBSixRQUFxQixVQUFPekIsT0FBUyxHQUFyQyw2Q0FFRixPQUFPRCxFQUdILFNBQVUrQixFQUFPVCxHQUVyQixJQUYrQyxJQUFUVSxFQUFTLHVEQUFELEVBQzFDaEMsRUFBTXNCLEVBQ0RXLEVBQVEsRUFBR0EsRUFBUUQsRUFBT0MsR0FBUyxFQUMxQ2pDLEVBQU00QixFQUFVLFdBQVYsSUFBYzVCLElBRXRCLE9BQU9BLEUscWxDQ25DSCxFLFdBUUosV0FBbUJaLEksNEZBQWlCLFNBTjdCLEtBQUE4QyxXQUFZLEVBQ1osS0FBQVosT0FBdUMsR0FFdkMsS0FBQWEsTUFBUSxHQUliQyxLQUFLaEQsR0FBS0EsRSw2REFFRWlELEdBQ1pBLEVBQUVDLGlCQUNGRixLQUFLRixXQUFZLEVBQ2pCRSxLQUFLZCxPQUFTLEdBQ2QsSUFBTWlCLEVBQVNDLFNBQVNDLGdCQUN0Qiw2QkFDQSxRQUVGTCxLQUFLaEQsR0FBR3NELFlBQVlILEdBQ3BCSCxLQUFLRyxPQUFTQSxJLG9DQVFGRixHQUFlLFdBQzNCLEdBQUtELEtBQUtGLFlBR1ZHLEVBQUVDLG1CQUNFRixLQUFLTyxjQUFnQkMsS0FBS0MsTUFBUVQsS0FBS08sYUFBZSxJQUExRCxDQUdBUCxLQUFLTyxhQUFlQyxLQUFLQyxNQVJFLE1BU1YsRUFBMEIxRCxlQUFlaUQsS0FBS2hELEdBQUlpRCxHQUU3RHBELEVBQVcsQ0FBRVMsRUFYUSxFQVNuQkEsRUFFY0MsRUFYSyxFQVNoQkEsRUFFY2UsRUFEZjJCLEVBQUVTLFNBQVdWLEtBQUtELE9BRXRCWSxFQUFZWCxLQUFLZCxPQUFPRSxPQUFPLEdBQUcsR0FFdEN1QixHQUNBLEVBQTZCOUMsT0FBTzhDLEVBQVc5RCxHQUFLbUQsS0FBS0QsUUFJM0RDLEtBQUtkLE9BQU9JLEtBQUt6QyxHQUNLLFVBQWxCb0QsRUFBRVcsY0FDSlosS0FBS2QsT0FBU2MsS0FBS2QsT0FBTzJCLEtBQUksU0FBQ2xELEVBQUc1QyxFQUFHK0YsR0FBUCxPLCtVQUFBLElBQ3pCbkQsRUFEeUIsQ0FFNUJXLEVBQUcsRUFBS3lCLE9BQVNoRixFQUFJK0YsRUFBTWpELGNBRy9CbUMsS0FBS2UsYSxrQ0FFS2QsR0FDVkEsRUFBRUMsaUJBQ0ZGLEtBQUtGLFdBQVksU0FDVkUsS0FBS0csUyxnQ0FHWkgsS0FBS2hELEdBQUdnRSxpQkFBaUIsY0FBZWhCLEtBQUtpQixjQUFjMUUsS0FBS3lELE9BQ2hFQSxLQUFLaEQsR0FBR2dFLGlCQUFpQixjQUFlaEIsS0FBS2tCLGNBQWMzRSxLQUFLeUQsT0FDaEVBLEtBQUtoRCxHQUFHZ0UsaUJBQWlCLFlBQWFoQixLQUFLbUIsWUFBWTVFLEtBQUt5RCxTLCtCQUV4RCxJQUNJM0UsRUFBTSxVQUFvQixFQUM3QixFQUE0QjJFLEtBQUtkLE9BQVEsS0FEdEM3RCxFQUdSMkUsS0FBS29CLFdBQVdDLGFBQWEsSUFBS2hHLEssaUNBL0NsQyxJQUFLMkUsS0FBS0csT0FDUixNQUFNLElBQUkvQyxNQUFNLHFCQUVsQixPQUFPNEMsS0FBS0csWSxpQ0FnRGhCLFdBQ0UsSUFBTW5ELEVBQUtvRCxTQUFTa0IsY0FBYyxjQUNsQyxLQUFNdEUsYUFBY3VFLGVBQ2xCLE1BQU1uRSxNQUFNLDBCQUVkLElBQUksRUFBZUosR0FBSXdFLFVBQ3ZCeEUsRUFBR2dFLGlCQUFpQixlQUFlLFNBQUFmLEdBQ2pDLElBQU1qRCxFQUFLb0QsU0FBU2tCLGNBQWMsYUFDN0J0RSxJQUdMQSxFQUFHeUUsWUFBY3hCLEVBQUVTLFNBQVNnQixlQUU5QjFFLEVBQUdnRSxpQkFBaUIsZUFBZSxTQUFBZixHQUNqQyxJQUFNakQsRUFBS29ELFNBQVNrQixjQUFjLGlCQUM3QnRFLElBR0xBLEVBQUd5RSxZQUFjeEIsRUFBRVcsZ0JBbEJ2QiIsImZpbGUiOiJpbmRleC41MzQyYWNhMmIxYWI3M2ZlNGJkYy5qcyIsInNvdXJjZXNDb250ZW50IjpbIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGdldHRlciB9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykge1xuIFx0XHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcbiBcdFx0fVxuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuIFx0fTtcblxuIFx0Ly8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0XG4gXHQvLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXRcbiBcdC8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBuc1xuIFx0Ly8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0XG4gXHQvLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbih2YWx1ZSwgbW9kZSkge1xuIFx0XHRpZihtb2RlICYgMSkgdmFsdWUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKHZhbHVlKTtcbiBcdFx0aWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTtcbiBcdFx0aWYoKG1vZGUgJiA0KSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICYmIHZhbHVlLl9fZXNNb2R1bGUpIHJldHVybiB2YWx1ZTtcbiBcdFx0dmFyIG5zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTtcbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG5zLCAnZGVmYXVsdCcsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHZhbHVlIH0pO1xuIFx0XHRpZihtb2RlICYgMiAmJiB0eXBlb2YgdmFsdWUgIT0gJ3N0cmluZycpIGZvcih2YXIga2V5IGluIHZhbHVlKSBfX3dlYnBhY2tfcmVxdWlyZV9fLmQobnMsIGtleSwgZnVuY3Rpb24oa2V5KSB7IHJldHVybiB2YWx1ZVtrZXldOyB9LmJpbmQobnVsbCwga2V5KSk7XG4gXHRcdHJldHVybiBucztcbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSAwKTtcbiIsImV4cG9ydCBmdW5jdGlvbiB0cmFuc2xhdGVQb2ludChcbiAgZWw6IFNWR1NWR0VsZW1lbnQsXG4gIHBvaW50OiB7IHg6IG51bWJlcjsgeTogbnVtYmVyIH1cbik6IERPTVBvaW50IHtcbiAgY29uc3QgbWF0cml4ID0gZWwuZ2V0U2NyZWVuQ1RNKCk7XG5cbiAgaWYgKCFtYXRyaXgpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ1Nob3VsZCBoYXMgc2NyZWVuIENUTS4nKTtcbiAgfVxuICBjb25zdCBwID0gZWwuY3JlYXRlU1ZHUG9pbnQoKTtcbiAgcC54ID0gcG9pbnQueDtcbiAgcC55ID0gcG9pbnQueTtcbiAgcmV0dXJuIHAubWF0cml4VHJhbnNmb3JtKG1hdHJpeC5pbnZlcnNlKCkpO1xufVxuIiwiLyoqIGh0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vYS80MzU1MDI2OCAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJlZmluZUZsb2F0KHY6IG51bWJlcik6IG51bWJlciB7XG4gIHJldHVybiB2ICsgOCAtIDg7XG59XG4iLCJpbXBvcnQgeyBWZWN0b3IyIH0gZnJvbSAnLi4vdHlwZXMnO1xuXG4vKiogTGVuZ3RoIGJldHdlZW4gcG9pbnRzICovXG5leHBvcnQgZnVuY3Rpb24gbGVuZ3RoKC4uLnBvaW50czogVmVjdG9yMltdKTogbnVtYmVyIHtcbiAgbGV0IHJldCA9IDA7XG4gIGZvciAobGV0IGkgPSAxOyBpIDwgcG9pbnRzLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgY29uc3QgcGEgPSBwb2ludHNbaSAtIDFdO1xuICAgIGNvbnN0IHBiID0gcG9pbnRzW2ldO1xuICAgIHJldCArPSBNYXRoLnNxcnQoTWF0aC5wb3cocGEueCAtIHBiLngsIDIpICsgTWF0aC5wb3cocGEueSAtIHBiLnksIDIpKTtcbiAgfVxuICByZXR1cm4gcmV0O1xufVxuIiwiaW1wb3J0IHsgUG9pbnQsIFZlY3RvcjIgfSBmcm9tICcuL3R5cGVzJztcbmltcG9ydCB7IHJlZmluZUZsb2F0IH0gZnJvbSAnLi91dGlscy9yZWZpbmVGbG9hdCc7XG5pbXBvcnQgKiBhcyB2ZWN0b3IyIGZyb20gJy4vdmVjdG9yMic7XG5cbmV4cG9ydCBmdW5jdGlvbiBjb21wdXRlU2lkZVBvaW50cyhcbiAgY3VycmVudDogUG9pbnQsXG4gIHByZXY/OiBQb2ludFxuKTogeyBsZWZ0OiBWZWN0b3IyOyByaWdodDogVmVjdG9yMiB9IHtcbiAgY29uc3QgciA9IGN1cnJlbnQudyAvIDI7XG4gIGlmICghcHJldikge1xuICAgIHJldHVybiB7XG4gICAgICBsZWZ0OiB7XG4gICAgICAgIHg6IGN1cnJlbnQueCxcbiAgICAgICAgeTogY3VycmVudC55ICsgcixcbiAgICAgIH0sXG4gICAgICByaWdodDoge1xuICAgICAgICB4OiBjdXJyZW50LngsXG4gICAgICAgIHk6IGN1cnJlbnQueSAtIHIsXG4gICAgICB9LFxuICAgIH07XG4gIH1cbiAgY29uc3QgYW5nbGUgPSBNYXRoLmF0YW4oKGN1cnJlbnQueSAtIHByZXYueSkgLyAoY3VycmVudC54IC0gcHJldi54KSk7XG4gIGNvbnN0IGR4ID0gcmVmaW5lRmxvYXQoTWF0aC5zaW4oYW5nbGUpICogcik7XG4gIGNvbnN0IGR5ID0gcmVmaW5lRmxvYXQoTWF0aC5jb3MoYW5nbGUpICogcik7XG4gIHJldHVybiB7XG4gICAgbGVmdDoge1xuICAgICAgeDogY3VycmVudC54IC0gZHgsXG4gICAgICB5OiBjdXJyZW50LnkgKyBkeSxcbiAgICB9LFxuICAgIHJpZ2h0OiB7XG4gICAgICB4OiBjdXJyZW50LnggKyBkeCxcbiAgICAgIHk6IGN1cnJlbnQueSAtIGR5LFxuICAgIH0sXG4gIH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjb21wdXRlKC4uLnBvaW50czogUG9pbnRbXSk6IHsgZDogc3RyaW5nIH0ge1xuICBjb25zdCBvcGVyYXRpb25zOiBzdHJpbmdbXSA9IFsnTSddO1xuICBjb25zdCBlZGdlUG9pbnRzOiBWZWN0b3IyW10gPSBbXTtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBwb2ludHMubGVuZ3RoOyBpICs9IDEpIHtcbiAgICBjb25zdCB7IGxlZnQsIHJpZ2h0IH0gPSBjb21wdXRlU2lkZVBvaW50cyhcbiAgICAgIHBvaW50c1tpXSxcbiAgICAgIHBvaW50c1tpIC0gMV0gfHwgcG9pbnRzW2kgKyAxXVxuICAgICk7XG4gICAgY29uc3QgbGFzdExlZnQgPSBlZGdlUG9pbnRzLnNsaWNlKGkpWzBdO1xuICAgIGlmIChcbiAgICAgIGxhc3RMZWZ0ICYmXG4gICAgICB2ZWN0b3IyLmxlbmd0aChsYXN0TGVmdCwgbGVmdCkgPiB2ZWN0b3IyLmxlbmd0aChsYXN0TGVmdCwgcmlnaHQpXG4gICAgKSB7XG4gICAgICBlZGdlUG9pbnRzLnNwbGljZShpLCAwLCBsZWZ0LCByaWdodCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGVkZ2VQb2ludHMuc3BsaWNlKGksIDAsIHJpZ2h0LCBsZWZ0KTtcbiAgICB9XG4gIH1cbiAgZm9yIChjb25zdCBwIG9mIGVkZ2VQb2ludHMpIHtcbiAgICBvcGVyYXRpb25zLnB1c2goYCR7cC54fSwke3AueX1gKTtcbiAgfVxuICBjb25zdCBkID0gb3BlcmF0aW9ucy5qb2luKCcgJyk7XG4gIHJldHVybiB7IGQgfTtcbn1cbiIsImltcG9ydCB7IFBvaW50IH0gZnJvbSAnLi90eXBlcyc7XG5cbi8vIFJlZmVyOiBodHRwczovL2dpdGh1Yi5jb20vSmFtMy9jaGFpa2luLXNtb290aC9ibG9iL21hc3Rlci9pbmRleC5qc1xuXG5leHBvcnQgZnVuY3Rpb24gc21vb3RoT25jZSguLi5wb2ludHM6IFBvaW50W10pOiBQb2ludFtdIHtcbiAgY29uc3QgcmV0OiBQb2ludFtdID0gW107XG4gIGlmIChwb2ludHMubGVuZ3RoID09PSAwKSB7XG4gICAgcmV0dXJuIFtdO1xuICB9XG4gIHJldC5wdXNoKHsgLi4ucG9pbnRzWzBdIH0pO1xuICBmb3IgKGxldCBpID0gMDsgaSA8IHBvaW50cy5sZW5ndGggLSAxOyBpKyspIHtcbiAgICBjb25zdCBwMCA9IHBvaW50c1tpXTtcbiAgICBjb25zdCBwMSA9IHBvaW50c1tpICsgMV07XG5cbiAgICByZXQucHVzaChcbiAgICAgIHtcbiAgICAgICAgeDogMC43NSAqIHAwLnggKyAwLjI1ICogcDEueCxcbiAgICAgICAgeTogMC43NSAqIHAwLnkgKyAwLjI1ICogcDEueSxcbiAgICAgICAgdzogcDAudyAqIDAuNzUgKyBwMS53ICogMC4yNSxcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIHg6IDAuMjUgKiBwMC54ICsgMC43NSAqIHAxLngsXG4gICAgICAgIHk6IDAuMjUgKiBwMC55ICsgMC43NSAqIHAxLnksXG4gICAgICAgIHc6IHAwLncgKiAwLjI1ICsgcDEudyAqIDAuNzUsXG4gICAgICB9XG4gICAgKTtcbiAgfVxuICBpZiAocG9pbnRzLmxlbmd0aCA+IDIpIHtcbiAgICByZXQucHVzaCh7IC4uLnBvaW50c1twb2ludHMubGVuZ3RoIC0gMV0gfSk7XG4gIH1cbiAgcmV0dXJuIHJldDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHNtb290aChwb2ludHM6IFBvaW50W10sIHRpbWVzID0gMSk6IFBvaW50W10ge1xuICBsZXQgcmV0ID0gcG9pbnRzO1xuICBmb3IgKGxldCBjb3VudCA9IDA7IGNvdW50IDwgdGltZXM7IGNvdW50ICs9IDEpIHtcbiAgICByZXQgPSBzbW9vdGhPbmNlKC4uLnJldCk7XG4gIH1cbiAgcmV0dXJuIHJldDtcbn1cbiIsImltcG9ydCAqIGFzIHN2Z1ZhcmlhYmxlV2lkdGhMaW5lIGZyb20gJ0AnO1xuaW1wb3J0IHsgUG9pbnQgfSBmcm9tICdAJztcblxuY2xhc3MgRHJhd2luZ0hhbmRsZXIge1xuICBwdWJsaWMgZWw6IFNWR1NWR0VsZW1lbnQ7XG4gIHB1YmxpYyBpc0RyYXdpbmcgPSBmYWxzZTtcbiAgcHVibGljIHBvaW50czogc3ZnVmFyaWFibGVXaWR0aExpbmUuUG9pbnRbXSA9IFtdO1xuICBwdWJsaWMgdGFyZ2V0PzogU1ZHUGF0aEVsZW1lbnQ7XG4gIHB1YmxpYyB3aWR0aCA9IDIwO1xuICBwdWJsaWMgbGFzdERyYXdUaW1lPzogbnVtYmVyO1xuXG4gIHB1YmxpYyBjb25zdHJ1Y3RvcihlbDogU1ZHU1ZHRWxlbWVudCkge1xuICAgIHRoaXMuZWwgPSBlbDtcbiAgfVxuICBvblBvaW50ZXJkb3duKGU6IFBvaW50ZXJFdmVudCk6IHZvaWQge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICB0aGlzLmlzRHJhd2luZyA9IHRydWU7XG4gICAgdGhpcy5wb2ludHMgPSBbXTtcbiAgICBjb25zdCB0YXJnZXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoXG4gICAgICAnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLFxuICAgICAgJ3BhdGgnXG4gICAgKTtcbiAgICB0aGlzLmVsLmFwcGVuZENoaWxkKHRhcmdldCk7XG4gICAgdGhpcy50YXJnZXQgPSB0YXJnZXQ7XG4gIH1cbiAgZ2V0IG11c3RUYXJnZXQoKTogU1ZHUGF0aEVsZW1lbnQge1xuICAgIGlmICghdGhpcy50YXJnZXQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignU2hvdWxkIGhhcyB0YXJnZXQnKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMudGFyZ2V0O1xuICB9XG4gIG9uUG9pbnRlcm1vdmUoZTogUG9pbnRlckV2ZW50KTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLmlzRHJhd2luZykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgaWYgKHRoaXMubGFzdERyYXdUaW1lICYmIERhdGUubm93KCkgLSB0aGlzLmxhc3REcmF3VGltZSA8IDQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5sYXN0RHJhd1RpbWUgPSBEYXRlLm5vdygpO1xuICAgIGNvbnN0IHsgeCwgeSB9ID0gc3ZnVmFyaWFibGVXaWR0aExpbmUudXRpbC50cmFuc2xhdGVQb2ludCh0aGlzLmVsLCBlKTtcbiAgICBjb25zdCB3ID0gZS5wcmVzc3VyZSAqIHRoaXMud2lkdGg7XG4gICAgY29uc3QgcDogUG9pbnQgPSB7IHgsIHksIHcgfTtcbiAgICBjb25zdCBsYXN0UG9pbnQgPSB0aGlzLnBvaW50cy5zbGljZSgtMSlbMF07XG4gICAgaWYgKFxuICAgICAgbGFzdFBvaW50ICYmXG4gICAgICBzdmdWYXJpYWJsZVdpZHRoTGluZS52ZWN0b3IyLmxlbmd0aChsYXN0UG9pbnQsIHApIDwgdGhpcy53aWR0aFxuICAgICkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLnBvaW50cy5wdXNoKHApO1xuICAgIGlmIChlLnBvaW50ZXJUeXBlID09PSAnbW91c2UnKSB7XG4gICAgICB0aGlzLnBvaW50cyA9IHRoaXMucG9pbnRzLm1hcCgodiwgaSwgYXJyYXkpID0+ICh7XG4gICAgICAgIC4uLnYsXG4gICAgICAgIHc6IHRoaXMud2lkdGggKiAoaSAvIGFycmF5Lmxlbmd0aCksXG4gICAgICB9KSk7XG4gICAgfVxuICAgIHRoaXMudXBkYXRlKCk7XG4gIH1cbiAgb25Qb2ludGVydXAoZTogUG9pbnRlckV2ZW50KTogdm9pZCB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIHRoaXMuaXNEcmF3aW5nID0gZmFsc2U7XG4gICAgZGVsZXRlIHRoaXMudGFyZ2V0O1xuICB9XG4gIGluc3RhbGwoKTogdm9pZCB7XG4gICAgdGhpcy5lbC5hZGRFdmVudExpc3RlbmVyKCdwb2ludGVyZG93bicsIHRoaXMub25Qb2ludGVyZG93bi5iaW5kKHRoaXMpKTtcbiAgICB0aGlzLmVsLmFkZEV2ZW50TGlzdGVuZXIoJ3BvaW50ZXJtb3ZlJywgdGhpcy5vblBvaW50ZXJtb3ZlLmJpbmQodGhpcykpO1xuICAgIHRoaXMuZWwuYWRkRXZlbnRMaXN0ZW5lcigncG9pbnRlcnVwJywgdGhpcy5vblBvaW50ZXJ1cC5iaW5kKHRoaXMpKTtcbiAgfVxuICB1cGRhdGUoKTogdm9pZCB7XG4gICAgY29uc3QgeyBkIH0gPSBzdmdWYXJpYWJsZVdpZHRoTGluZS5jb21wdXRlKFxuICAgICAgLi4uc3ZnVmFyaWFibGVXaWR0aExpbmUuc21vb3RoKHRoaXMucG9pbnRzLCA0KVxuICAgICk7XG4gICAgdGhpcy5tdXN0VGFyZ2V0LnNldEF0dHJpYnV0ZSgnZCcsIGQpO1xuICB9XG59XG5cbigoKTogdm9pZCA9PiB7XG4gIGNvbnN0IGVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcignc3ZnI2NhbnZhcycpO1xuICBpZiAoIShlbCBpbnN0YW5jZW9mIFNWR1NWR0VsZW1lbnQpKSB7XG4gICAgdGhyb3cgRXJyb3IoJ01pc3NpbmcgY2FudmFzIGVsZW1lbnQnKTtcbiAgfVxuICBuZXcgRHJhd2luZ0hhbmRsZXIoZWwpLmluc3RhbGwoKTtcbiAgZWwuYWRkRXZlbnRMaXN0ZW5lcigncG9pbnRlcm1vdmUnLCBlID0+IHtcbiAgICBjb25zdCBlbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNwcmVzc3VyZScpO1xuICAgIGlmICghZWwpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgZWwudGV4dENvbnRlbnQgPSBlLnByZXNzdXJlLnRvU3RyaW5nKCk7XG4gIH0pO1xuICBlbC5hZGRFdmVudExpc3RlbmVyKCdwb2ludGVybW92ZScsIGUgPT4ge1xuICAgIGNvbnN0IGVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3BvaW50ZXItdHlwZScpO1xuICAgIGlmICghZWwpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgZWwudGV4dENvbnRlbnQgPSBlLnBvaW50ZXJUeXBlO1xuICB9KTtcbn0pKCk7XG4iXSwic291cmNlUm9vdCI6IiJ9